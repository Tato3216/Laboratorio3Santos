{% extends "base.html" %}
{% block content %}
<h1 class="h3">{{ 'Editar' if followup else 'Nuevo' }} seguimiento</h1>

<form method="post" class="mt-3">
  <div class="row g-3">
    <div class="col-md-4">
      <label class="form-label">Cliente</label>
      <select name="client_id" class="form-select" required>
        <option value="">Selecciona...</option>
        {% for c in clients %}
          <option value="{{ c.id }}" {% if (followup and followup.client_id==c.id) or (not followup and client_id==c.id) %}selected{% endif %}>
            {{ c.full_name() }} — {{ c.email }}
          </option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-4">
      <label class="form-label">Pedido (opcional)</label>
      <select name="order_id" class="form-select">
        <option value="">— Ninguno —</option>
        {% for o in orders %}
          <option value="{{ o.id }}" {% if followup and followup.order_id==o.id %}selected{% endif %}>#{{ o.id }} — {{ o.client.full_name() }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-4">
      <label class="form-label">Tipo</label>
      <select name="kind" class="form-select">
        {% for k in ['seguimiento','entrega','cobro'] %}
          <option value="{{ k }}" {% if followup and followup.kind==k %}selected{% endif %}>{{ k|capitalize }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-6">
      <label class="form-label">Título</label>
      <input name="title" class="form-control" value="{{ followup.title if followup else '' }}" required>
    </div>
    <div class="col-md-6">
      <label class="form-label">Fecha y hora</label>
      <input name="when_at" type="datetime-local" class="form-control"
             value="{{ (followup.when_at.strftime('%Y-%m-%dT%H:%M') if followup else '') }}" required>
    </div>
    <div class="col-12">
      <label class="form-label">Notas</label>
      <textarea name="notes" rows="3" class="form-control">{{ followup.notes if followup else '' }}</textarea>
    </div>
  </div>

  <div class="mt-3 d-flex gap-2">
    <button class="btn btn-primary" type="submit">Guardar</button>
    <a class="btn btn-outline-secondary" href="{{ url_for('followups.calendar_view') }}">Cancelar</a>

    {% if followup %}
      <button name="action" value="toggle_done" class="btn btn-outline-success" type="submit">
        {{ 'Marcar pendiente' if followup.done else 'Marcar hecho' }}
      </button>
      <button name="action" value="delete" class="btn btn-outline-danger" type="submit"
              onclick="return confirm('¿Eliminar este seguimiento?');">
        Eliminar
      </button>
    {% endif %}
  </div>
</form>
{% endblock %}